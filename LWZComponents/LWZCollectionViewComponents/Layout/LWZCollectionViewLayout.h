//
//  LWZCollectionViewLayout.h
//  LWZCollectionViewComponents_Example
//
//  Created by BlueDancer on 2020/11/13.
//  Copyright Â© 2020 changsanjiang@gmail.com. All rights reserved.
//

#import "LWZCollectionDefines.h"
#import "LWZCollectionLayoutContainer.h"
#import "UICollectionViewLayoutAttributes+LWZCollectionAdditions.h"
@protocol LWZCollectionViewLayoutObserver, LWZCollectionViewLayoutDelegate;
@class LWZCollectionLayoutSolver;

NS_ASSUME_NONNULL_BEGIN
@interface LWZCollectionViewLayout : UICollectionViewLayout<LWZCollectionLayout>

@property(class, nonatomic, readonly) Class layoutSolverClass;

- (instancetype)initWithScrollDirection:(UICollectionViewScrollDirection)scrollDirection;
- (instancetype)initWithScrollDirection:(UICollectionViewScrollDirection)scrollDirection delegate:(nullable id<LWZCollectionViewLayoutDelegate>)delegate;
@property (nonatomic, weak, nullable) id<LWZCollectionViewLayoutDelegate> delegate;

@property (nonatomic, readonly) UICollectionViewScrollDirection scrollDirection;

@property (nonatomic, strong, readonly) LWZCollectionLayoutSolver *layoutSolver;

- (void)prepareLayoutForCollectionSize:(CGSize)size contentInsets:(UIEdgeInsets)contentInsets;

@property (nonatomic, getter=isIgnoredSafeAreaInsets) BOOL ignoredSafeAreaInsets NS_AVAILABLE_IOS(11.0); // default value is YES.
- (void)prepareLayoutForCollectionSize:(CGSize)size contentInsets:(UIEdgeInsets)contentInsets safeAreaInsets:(UIEdgeInsets)safeAreaInsets NS_AVAILABLE_IOS(11.0);

@property (nonatomic) BOOL sectionHeadersPinToVisibleBounds;
//@property (nonatomic) BOOL sectionFootersPinToVisibleBounds;

@property (nonatomic) UIEdgeInsets adjustedPinnedInsets;

- (CGRect)layoutFrameForSection:(NSInteger)section;

- (void)enumerateLayoutAttributesWithElementCategory:(UICollectionElementCategory)category usingBlock:(void(NS_NOESCAPE ^)(UICollectionViewLayoutAttributes *attributes, BOOL *stop))block;
- (nullable NSArray<UICollectionViewLayoutAttributes *> *)layoutAttributesObjectsForElementCategory:(UICollectionElementCategory)category;
- (nullable NSArray<UICollectionViewLayoutAttributes *> *)layoutAttributesObjectsForElementCategory:(UICollectionElementCategory)category inSection:(NSInteger)section;

- (void)registerObserver:(id<LWZCollectionViewLayoutObserver>)observer;
- (void)removeObserver:(id<LWZCollectionViewLayoutObserver>)observer;

- (instancetype)init NS_UNAVAILABLE;
+ (instancetype)new NS_UNAVAILABLE;
@end


@interface LWZCollectionViewLayout (LWZCollectionFittingSize)
- (void)prepareLayoutFittingSize:(CGSize)fittingSize contentInsets:(UIEdgeInsets)contentInsets;
- (void)prepareLayoutFittingSize:(CGSize)fittingSize contentInsets:(UIEdgeInsets)contentInsets safeAreaInsets:(UIEdgeInsets)safeAreaInsets NS_AVAILABLE_IOS(11.0);
@end

#pragma mark - observer methods

@protocol LWZCollectionViewLayoutObserver <NSObject>
@optional
- (void)layout:(__kindof LWZCollectionViewLayout *)layout willPrepareLayoutInContainer:(LWZCollectionLayoutContainer *)container;

- (void)layout:(__kindof LWZCollectionViewLayout *)layout didFinishPreparingInContainer:(LWZCollectionLayoutContainer *)container;
@end

 
#pragma mark - delegate methods
 
@protocol LWZCollectionViewLayoutDelegate <LWZCollectionViewLayoutObserver>
@optional

/**
 \code
 
                          +---------------------------+
                          |                           |
                          |   edgeSpacings.top        |
                          |                           |
  +-----------------------+---------------------------+-------------------------+
  |                       |                           |                         |
  |                       |                           |                         |
  |   edgeSpacings.left   |          Section          |   edgeSpacings.right    |
  |                       |                           |                         |
  |                       |                           |                         |
  +-----------------------+---------------------------+-------------------------+
                          |                           |
                          |   edgeSpacings.bottom     |
                          |                           |
                          +---------------------------+
 \endcode
 */
- (UIEdgeInsets)layout:(__kindof LWZCollectionViewLayout *)layout edgeSpacingsForSectionAtIndex:(NSInteger)section;

/**
 \code
 +------------------------------------------------------------------------------+
 |                                                                              |
 |                               section.header                                 |
 |                                                                              |
 +------------------------+----------------------------+------------------------+
                          |                            |
                          |     contentInsets.top      |
                          |                            |
 +------------------------+------+---+------+---+------+------------------------+
 |                        |      |   |      |   |      |                        |
 |                        | cell |   | cell |   | cell |                        |
 |                        |      |   |      |   |      |                        |
 |                        +------+   +------+   +------+                        |
 |   contentInsets.left   |                            |   contentInset.right   |
 |                        +------+   +------+   +------+                        |
 |                        |      |   |      |   |      |                        |
 |                        | cell |   | cell |   | cell |                        |
 |                        |      |   |      |   |      |                        |
 +------------------------+------+---+------+---+------+------------------------+
                          |                            |
                          |     contentInsets.bottom   |
                          |                            |
 +------------------------+----------------------------+------------------------+
 |                                                                              |
 |                               section.footer                                 |
 |                                                                              |
 +------------------------------------------------------------------------------+
 \endcode
 */
- (UIEdgeInsets)layout:(__kindof LWZCollectionViewLayout *)layout contentInsetsForSectionAtIndex:(NSInteger)section;

- (BOOL)layout:(__kindof LWZCollectionViewLayout *)layout canPinToVisibleBoundsForHeaderInSection:(NSInteger)section;
- (UIEdgeInsets)layout:(__kindof LWZCollectionViewLayout *)layout adjustedPinnedInsetsForSectionAtIndex:(NSInteger)section;

- (CGSize)layout:(__kindof LWZCollectionViewLayout *)layout layoutSizeToFit:(CGSize)fittingSize forHeaderInSection:(NSInteger)section scrollDirection:(UICollectionViewScrollDirection)scrollDirection;
- (CGSize)layout:(__kindof LWZCollectionViewLayout *)layout layoutSizeToFit:(CGSize)fittingSize forItemAtIndexPath:(NSIndexPath *)indexPath scrollDirection:(UICollectionViewScrollDirection)scrollDirection;
- (CGSize)layout:(__kindof LWZCollectionViewLayout *)layout layoutSizeToFit:(CGSize)fittingSize forFooterInSection:(NSInteger)section scrollDirection:(UICollectionViewScrollDirection)scrollDirection;

/**
 \code
 +--------------------------[V]-------------------------+
 |                                                      |
 |      +------------------+                            |
 |      | interitemSpacing |                            |
 |      +------------------+                            |
 |               |                                      |
 |               v                                      |
 |  +----------+   +----------+                         |
 |  | ~~~~~~~~ |   | ~~~~~~~~ |                         |
 |  | ~~~~~~~~ |   | ~~~~~~~~ |                         |
 |  | ~~~~~~~~ |   | ~~~~~~~~ |                         |
 |  | ~~~~~~~~ |   +----------+        +-------------+  |
 |  | ~~~~~~~~ |                <----- | lineSpacing |  |
 |  | ~~~~~~~~ |   +----------+        +-------------+  |
 |  +----------+   | ~~~~~~~~ |                         |
 |                 | ~~~~~~~~ |                         |
 |  +----------+   | ~~~~~~~~ |                         |
 |  | ~~~~~~~~ |   | ~~~~~~~~ |                         |
 |  |  ~~~~~~~ |   | ~~~~~~~~ |                         |
 |  |   ~~~~~~ |   |   ~~~~~~ |                         |
 |  |     .... |   |     .... |                         |
 |                                                      |
 +------------------------------------------------------+
 
 +---------------------------------[H]------------------------------+
 |                                                                  |
 |           +-------------+                                        |
 |           | lineSpacing |                                        |
 |           +-------------+                                        |
 |                  |                                               |
 |                  v                                               |
 |  +-------------+   +------------                                 |
 |  | ~~~~~~~~~~~ |   | ~~~~~~~                                     |
 |  | ~~~~~~~~~~~ |   | ~~~~~~~~                                    |
 |  | ~~~~~~~~~~~ |   | ~~~~~~~~~~                                  |
 |  +-------------+   +------------          +------------------+   |
 |                                      <--- | interitemSpacing |   |
 |  +--------------------+   +---------      +------------------+   |
 |  | ~~~~~~~~~~~~~~~~~~ |   | ~~~~~                                |
 |  | ~~~~~~~~~~~~~~~~~~ |   | ~~~~~~                               |
 |  | ~~~~~~~~~~~~~~~~~~ |   | ~~~~~~~                              |
 |  +--------------------+   +---------                             |
 |                                                                  |
 +------------------------------------------------------------------+
 \endcode
 */
- (CGFloat)layout:(__kindof LWZCollectionViewLayout *)layout minimumLineSpacingForSectionAtIndex:(NSInteger)section;
- (CGFloat)layout:(__kindof LWZCollectionViewLayout *)layout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section;


- (nullable NSString *)layout:(__kindof LWZCollectionViewLayout *)layout elementKindForSectionDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (nullable NSString *)layout:(__kindof LWZCollectionViewLayout *)layout elementKindForHeaderDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (nullable NSString *)layout:(__kindof LWZCollectionViewLayout *)layout elementKindForItemDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (nullable NSString *)layout:(__kindof LWZCollectionViewLayout *)layout elementKindForFooterDecorationAtIndexPath:(NSIndexPath *)indexPath;

- (nullable id)layout:(__kindof LWZCollectionViewLayout *)layout userInfoForSectionDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (nullable id)layout:(__kindof LWZCollectionViewLayout *)layout userInfoForHeaderDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (nullable id)layout:(__kindof LWZCollectionViewLayout *)layout userInfoForItemDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (nullable id)layout:(__kindof LWZCollectionViewLayout *)layout userInfoForFooterDecorationAtIndexPath:(NSIndexPath *)indexPath;

- (CGRect)layout:(__kindof LWZCollectionViewLayout *)layout relativeRectToFit:(CGRect)rect forSectionDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (CGRect)layout:(__kindof LWZCollectionViewLayout *)layout relativeRectToFit:(CGRect)rect forHeaderDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (CGRect)layout:(__kindof LWZCollectionViewLayout *)layout relativeRectToFit:(CGRect)rect forItemDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (CGRect)layout:(__kindof LWZCollectionViewLayout *)layout relativeRectToFit:(CGRect)rect forFooterDecorationAtIndexPath:(NSIndexPath *)indexPath;

- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForHeaderInSection:(NSInteger)section;
- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForItemAtIndexPath:(NSIndexPath *)indexPath;
- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForFooterInSection:(NSInteger)section;

- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForSectionDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForHeaderDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForItemDecorationAtIndexPath:(NSIndexPath *)indexPath;
- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout zIndexForFooterDecorationAtIndexPath:(NSIndexPath *)indexPath;
@end

// [V]åç´å¸å±
// [H]æ°´å¹³å¸å±

#pragma mark - weight

@protocol LWZCollectionViewWeightLayoutDelegate <LWZCollectionViewLayoutDelegate>
@optional
/// (0, 1]
/// å¦ææªå®ç°, é»è®¤ä¸º1
- (CGFloat)layout:(__kindof LWZCollectionViewLayout *)layout layoutWeightForItemAtIndexPath:(NSIndexPath *)indexPath;
@end

/**
 \code
 æ ¹æ®æ¯éå¸å±
 [V] åç´å¸å±æ¶, æ¯è¡æ ¹æ®æ¯éåéitemçå®½åº¦, åè¡itemçé«åº¦ä¸è¡é¦itemä¸è´
 [H] æ°´å¹³å¸å±åç
 
 
 [V] åç´å¸å±, bounds.width * weight ==> item.maxWidth,  å¯ä»¥å°äºä½ä¸è½å¤§äº. å½ item.width > maxWidth æ¶, å°è¢«ä¿®æ­£ä¸º maxWidth
 +---------------------------+
 |                           |
 |    weight = 1.0           |
 |                           |
 +-------------+-------------+
 |             |             |
 |   0.5       |    0.5      |
 |             |             |
 +---------+---+-------------+
 |         |                 |
 |         |                 |
 +---------+-----------------+
  
 [H] æ°´å¹³å¸å±, bounds.height * weight ==> item.maxHeight,  å¯ä»¥å°äºä½ä¸è½å¤§äº. å½ item.height > maxHeight æ¶, å°è¢«ä¿®æ­£ä¸º maxHeight
 +--------------+-----+------+
 |              |     |      |
 |              |     |      |
 |              |     |      |
 |              | 0.5 |      |
 | weight = 1.0 +-----+      |
 |              |     | 0.75 |
 |              |     +------+
 |              |     |      |
 |              | 0.5 | 0.25 |
 +--------------+-----+------+
 
 \endcode
 */
@interface LWZCollectionViewWeightLayout : LWZCollectionViewLayout
@property (nonatomic, weak, nullable) id<LWZCollectionViewWeightLayoutDelegate> delegate;
@end


#pragma mark - list

@protocol LWZCollectionViewListLayoutDelegate <LWZCollectionViewLayoutDelegate>
@optional
- (LWZCollectionLayoutAlignment)layout:(__kindof LWZCollectionViewLayout *)layout layoutAlignmentForItemAtIndexPath:(NSIndexPath *)indexPath;
@end

/**
 åè¡¨å¸å±, åæ°[v]ä¸º1, è¡æ°[h]ä¸º1, interitemSpacing å°æ æ;
 
 [V] CollectionView å®½åº¦å¿é¡»è®¾ç½®
 [H] CollectionView é«åº¦å¿é¡»è®¾ç½®

 +---------[V]-------+
 |                   |
 |  +---------+      |
 |  | ~~~~~~~ |    <-+-- Start(å·¦å¯¹é½)
 |  | ~~~~~~~ |      |
 |  +---------+      |
 |                   |
 |    +---------+    |
 |    | ~~~~~~~ |  <-+-- Center(ä¸­å¯¹é½)
 |    | ~~~~~~~ |    |
 |    +---------+    |
 |                   |
 |      +---------+  |
 |      | ~~~~~~~ |<-+-- End(å³å¯¹é½)
 |      | ~~~~~~~ |  |
 |      +---------+  |
 |                   |
 +-------------------+
 
 +----------------------[H]----------------------+
 |                                               |
 |  +---------+                                <-+-- Start(é¡¶å¯¹é½)
 |  | ~~~~~~~ |     +---------+                  |
 |  | ~~~~~~~ |     | ~~~~~~~ |                <-+-- Center(ä¸­å¯¹é½)
 |  +---------+     | ~~~~~~~ |     +---------+  |
 |                  +---------+     | ~~~~~~~ |<-+-- End(åºå¯¹é½)
 |                                  | ~~~~~~~ |  |
 |                                  +---------+  |
 |                                               |
 +-----------------------------------------------+
 */
@interface LWZCollectionViewListLayout : LWZCollectionViewLayout
@property (nonatomic, weak, nullable) id<LWZCollectionViewListLayoutDelegate> delegate;
@end

#pragma mark - waterfall flow



@protocol LWZCollectionViewWaterfallFlowLayoutDelegate <LWZCollectionViewLayoutDelegate>
@optional
/// (0, ...)
/// å¦ææªå®ç°, é»è®¤ä¸º1
- (NSInteger)layout:(__kindof LWZCollectionViewLayout *)layout layoutNumberOfArrangedItemsPerLineInSection:(NSInteger)section;
@end

/**
 \code
 çå¸æµå¸å±
 [V] åç´å¸å±æ¶, æ¯è¡çitemå¹³åå®½åº¦, é«åº¦ä¸ä¸
 [H] æ°´å¹³å¸å±åç
 
 +-----------[V]----------+ ==> layoutNumberOfArrangedItemsPerLineInSection == 2
 |                        |
 |  +-------+  +-------+  |
 |  |       |  |       |  |
 |  |       |  |       |  |
 |  |   1   |  |       |  |
 |  +-------+  |   2   |  |
 |             +-------+  |
 |  +-------+
 |  |       |  +-------+  |
 |  |       |  |       |  |
 |  |       |  |       |  |
 |  |   3   |  |       |  |
 |  +-------+  |       |  |
 |             |   4   |  |
 |  +-------+  +-------+  |
 |  |       |             |
 |  |   ... |       ...   |
 |  v       v             |
 |                        |
 +------------------------+
 
 +-------------[H]--------------------+ ==> layoutNumberOfArrangedItemsPerLineInSection == 2
 |                                    |
 |  +-------+  +-----------+  +--->   |
 |  |       |  |           |  |       |
 |  |       |  |           |  |  ...  |
 |  +-------+  +-----------+  +--->   |
 |                                    |
 |  +-----------+  +----------+       |
 |  |           |  |          |       |
 |  |           |  |          |  ...  |
 |  +-----------+  +----------+       |
 |                                    |
 +------------------------------------+
 \endcode
 */
@interface LWZCollectionViewWaterfallFlowLayout : LWZCollectionViewLayout
@property (nonatomic, weak, nullable) id<LWZCollectionViewWaterfallFlowLayoutDelegate> delegate;
@end

#pragma mark - restricted layout

/**
 \code
 
 åéçå¸å±
 [V] åç´å¸å±æ¶: æ¯è¡itemçé«åº¦ä¸è¡é¦itemä¸è´, å®½åº¦ä¸ä¸
 [H] æ°´å¹³å¸å±åç
 
 +------------------[V]------------------------+
 |                                             |
 |  +-------+  +------------+  +------------+  |
 |  |       |  |            |  |            |  |
 |  |   1   |  |     2      |  |     3      |  |
 |  +-------+  +------------+  +------------+  |
 |                                             |
 |  +--------------------+  +-----+            |
 |  |                    |  |     |            |
 |  |         4          |  |  5  |            |
 |  +--------------------+  +-----+            |
 |                                             |
 |  +---------------+  +------------+   +---+  |
 |  |               |  |            |   |   |  |
 |  |       6       |  |     7      |   | 8 |  |
 |  +---------------+  +------------+   +---+  |
 |                                             |
 +---------------------------------------------+
 
  
 +------------------[H]-------------------------+
 |                                              |
 |  +-------+  +-------+  +-------+  +-------+  |
 |  |       |  |       |  |   6   |  |       |  |
 |  |   1   |  |       |  +-------+  |       |  |
 |  +-------+  |       |             |       |  |
 |             |       |  +-------+  |       |  |
 |  +-------+  |   4   |  |       |  |  9    |  |
 |  |       |  +-------+  |   7   |  +-------+  |
 |  |   2   |             +-------+             |
 |  +-------+  +-------+             +-------+  |
 |             |       |  +-------+  |       |  |
 |  +-------+  |       |  |       |  | 10    |  |
 |  |       |  |       |  |   8   |  +-------+  |
 |  |   3   |  |   5   |  +-------+             |
 |  +-------+  +-------+                        |
 |                                              |
 +----------------------------------------------+
 \endcode
 */
@interface LWZCollectionViewRestrictedLayout : LWZCollectionViewLayout

@end


#pragma mark - template layout

@protocol LWZCollectionViewTemplateLayoutDelegate <LWZCollectionViewLayoutDelegate>
- (NSArray<LWZCollectionTemplateGroup *> *)layout:(__kindof LWZCollectionViewLayout *)layout layoutTemplateContainerGroupsInSection:(NSInteger)section;
@end


/**
 æ¨¡æ¿å¸å±: å®ä¹ä¸å¥æ¨¡æ¿, cell çä½ç½®å°æ ¹æ®æ¨¡æ¿æè¿°è¿è¡å¸å±.
 
 \code
 
     Container1
     |
  +--+-----------------------[V]-------------------------+ <---- Group1
  |  v                                                   |
  |  +-------------------+   +-----------------------+ <-------- Container2
  |  |                   |   |                       |   |
  |  |   +-----------+   |   |   +---------------+ <------------ Item
  |  |   |           |   |   |   |               |   |   |
  |  |   |           |   |   |   |               |   |   |
  |  |   |     1     |   |   |   |               |   |   |
  |  |   +-----------+   |   |   |               |   |   |
  |  |                   |   |   |               |   |   |
  |  |   +-----------+   |   |   |        4      |   |   |
  |  |   |           |   |   |   +---------------+   |   |
  |  |   |           |   |   |                       |   |
  |  |   |     2     |   |   |   +---------------+   |   |
  |  |   +-----------+   |   |   |               |   |   |
  |  |                   |   |   |               |   |   |
  |  |   +-----------+   |   |   |               |   |   |
  |  |   |           |   |   |   |               |   |   |
  |  |   |           |   |   |   |               |   |   |
  |  |   |     3     |   |   |   |        5      |   |   |
  |  |   +-----------+   |   |   +---------------+   |   |
  |  |                   |   |                       |   |
  |  +-------------------+   +-----------------------+   |
  |                                                      |
  +------------------------------------------------------+

  +--------------------[H]---------------------+ <--- Group1
  |                                            |
  |  +--------------------------------------+ <------ Container1
  |  |                                      |  |
  |  |  +--------+  +--------+  +--------+ <--------- Item
  |  |  |        |  |        |  |        |  |  |
  |  |  |    1   |  |    2   |  |    3   |  |  |
  |  |  +--------+  +--------+  +--------+  |  |
  |  |                                      |  |
  |  +--------------------------------------+  |
  |                                            |
  |  +--------------------------------------+ <------ Container2
  |  |                                      |  |
  |  |  +--------------------+  +--------+ <--------- Item
  |  |  |                    |  |        |  |  |
  |  |  |         4          |  |   5    |  |  |
  |  |  +--------------------+  +--------+  |  |
  |  |                                      |  |
  |  +--------------------------------------+  |
  |                                            |
  +--------------------------------------------+
 \endcode
 */
@interface LWZCollectionViewTemplateLayout : LWZCollectionViewLayout
@property (nonatomic, weak, nullable) id<LWZCollectionViewTemplateLayoutDelegate> delegate;

@end

#pragma mark - multiple layout

@protocol LWZCollectionViewMultipleLayoutDelegate <
    LWZCollectionViewWeightLayoutDelegate,
    LWZCollectionViewListLayoutDelegate,
    LWZCollectionViewWaterfallFlowLayoutDelegate,
    LWZCollectionViewTemplateLayoutDelegate
>

/// è¿åæå®sectionçå¸å±æ¹å¼
- (LWZCollectionLayoutType)layout:(__kindof LWZCollectionViewLayout *)layout layoutTypeForItemsInSection:(NSInteger)section;
@end

/// å¤ç§æ¹å¼æ··åå¸å±
@interface LWZCollectionViewMultipleLayout : LWZCollectionViewLayout
@property (nonatomic, weak, nullable) id<LWZCollectionViewMultipleLayoutDelegate> delegate;

@end


#pragma mark - compositional layout

@protocol LWZCollectionViewCompositionalLayoutDelegate <LWZCollectionViewMultipleLayoutDelegate>
@optional
- (BOOL)layout:(__kindof LWZCollectionViewLayout *)layout isOrthogonalScrollingInSection:(NSInteger)section;
/**
 \code
 
 æ°´å¹³æ»å¨æ¶, éè¦æ ¹æ® fittingSize.width è®¡ç®åºåéçå¸å±é«åº¦
 åç´æ»å¨æ¶, éè¦æ ¹æ® fittingSize.height è®¡ç®åºåéçå¸å±å®½åº¦
 
 +------------------------------------------------------------------------------+
 |                                                                              |
 |                               section.header                                 |
 |                                                                              |
 +------------------------+----------------------------+------------------------+
                          |                            |
                          |     contentInsets.top      |
                          |                            |
 +------------------------<===== fittingSize.width ====>---+------+---+------+-+-+------+---+------+   <---+
 |                        |      |   |      |   |      |   |      |   |      | | |      |   |      |       |
 |                        | cell |   | cell |   | cell |   | cell |   | cell | | | cell |   | cell |       |
 |                        |      |   |      |   |      |   |      |   |      | | |      |   |      |       |
 |                        +------+   +------+   +------+   +------+   +------+ | +------+   +------+       |
 |   contentInsets.left   |                            |   contentInset.right  |                          ??? (layoutSize.height)
 |                        +------+   +------+   +------+   +------+   +------+ | +------+   +------+       |
 |                        |      |   |      |   |      |   |      |   |      | | |      |   |      |       |
 |                        | cell |   | cell |   | cell |   | cell |   | cell | | | cell |   | cell |       |
 |                        |      |   |      |   |      |   |      |   |      | | |      |   |      |       |
 +------------------------<======================== horizontal scroll =============================>   <---+
                          |                            |
                          |     contentInsets.bottom   |
                          |                            |
 +------------------------+----------------------------+------------------------+
 |                                                                              |
 |                               section.footer                                 |
 |                                                                              |
 +------------------------------------------------------------------------------+
 \endcode
 */
- (CGSize)layout:(__kindof LWZCollectionViewLayout *)layout layoutSizeToFit:(CGSize)fittingSize forOrthogonalContentInSection:(NSInteger)section scrollDirection:(UICollectionViewScrollDirection)scrollDirection;
- (LWZCollectionLayoutContentOrthogonalScrollingBehavior)layout:(__kindof LWZCollectionViewLayout *)layout orthogonalContentScrollingBehaviorInSection:(NSInteger)section;
@end

/**
 è¿ä¸ª layout ç±»ä¼¼äº `UICollectionViewCompositionalLayout`, ä½ä¸å®å¨ä¸æ ·, æ¯å­å¨ç¼ºé·ç.
 OrthogonalContent åºåç cell ä¼å¨åç¬ç collectionView ä¸­æ¾ç¤º, éè¿åæ¥ç CollectionView æ æ³è¿è¡ cell å indexPath çè½¬æ¢.
 ç¼ºé·å¦ä¸:
 
 ç¼ºé·1: [collectionView cellForItemAtIndexPath:] å¯è½è·åå°ä¸å°å¯¹åº cell
        æ¿ä»£æ¹æ¡: ä½¿ç¨ [layout isOrthogonalScrollingInSection:] & [layout orthogonalScrollingCellForItemAtIndexPath:];
 
 ç¼ºé·2: [collectionView indexPathForCell:] å¯è½è·åå°ä¸å°å¯¹åº indexPath
        æ¿ä»£æ¹æ¡: ä½¿ç¨ [(UICollectionView *)cell.superview indexPathForCell:];
 
 ç¼ºé·3: collectionView:willDisplayCell:forItemAtIndexPath: å collectionView:didEndDisplayingCell:forItemAtIndexPath: è¿ä¸¤ä¸ªæ¹æ³å¨æ»å¨ OrthogonalContent åºå, cell å¯è§ç¶æåçååæ¶, å¯¹åºç delegate æ¹æ³ä¼è§¦å, ä½å¨åºåå¤æ»å¨, å°ä¸ä¼è¢«è§¦å.
        ç®åæªè§£å³
 
 ç¼ºé·4: delete, move ç­ updates ç¸å³æ¹æ³å¯è½æ æ³æ­£å¸¸å·¥ä½.
 */
@interface LWZCollectionViewCompositionalLayout : LWZCollectionViewMultipleLayout

@property (nonatomic, weak, nullable) id<LWZCollectionViewCompositionalLayoutDelegate> delegate;

- (BOOL)isOrthogonalScrollingInSection:(NSInteger)section;
- (nullable __kindof UICollectionViewCell *)orthogonalScrollingCellForItemAtIndexPath:(NSIndexPath *)indexPath;
@end
NS_ASSUME_NONNULL_END
